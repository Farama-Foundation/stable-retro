<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark">
    <meta name="description" content="">
    <meta property="og:title" content="Stable-Retro Documentation" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="" />
    <meta property="og:url" content="https://stable-retro.farama.org/integration.html" /><meta property="og:image" content="https://stable-retro.farama.org/_static/img/stable-retro-github.png" /><meta name="twitter:card" content="summary_large_image"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex/" /><link rel="search" title="Search" href="../search/" /><link rel="next" title="Python API" href="../python/" /><link rel="prev" title="Development" href="../developing/" />
        <link rel="canonical" href="https://stable-retro.farama.org/integration.html" />

    <!-- Generated with Sphinx 7.2.4 and Furo 2023.08.19.dev1 -->
        <title>Game Integration - Stable-Retro Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=3e7f4c72" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=49cbaffd" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    <header class="farama-header" aria-label="Farama header">
      <div class="farama-header__container">
        <div class="farama-header__left--mobile">
          <label class="nav-overlay-icon" for="__navigation">
            <div class="visually-hidden">Toggle site navigation sidebar</div>
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <defs></defs>
              <line x1="0.5" y1="4" x2="23.5" y2="4"></line>
              <line x1="0.232" y1="12" x2="23.5" y2="12"></line>
              <line x1="0.232" y1="20" x2="23.5" y2="20"></line>
            </svg>
          </label>
        </div>
        <div class="farama-header__left farama-header__center--mobile">
          <a href="../">
              <img class="farama-header__logo only-light" src="../_static/img/stable_retro_black.svg" alt="Light Logo"/>
              <img class="farama-header__logo only-dark" src="../_static/img/stable_retro_white.svg" alt="Dark Logo"/>
            <span class="farama-header__title">Stable-Retro Documentation</span>
          </a>
        </div>
        <div class="farama-header__right">
          <div class="farama-header-menu">
            <button class="farama-header-menu__btn" aria-label="Open Farama Menu" aria-expanded="false" aria-haspopup="true" aria-controls="farama-menu">
              <img class="farama-black-logo-invert" src="../_static/img/farama-logo-header.svg">
              <svg viewBox="0 0 24 24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <polyline style="stroke-linecap: round; stroke-linejoin: round; fill: none; stroke-width: 2px;" points="1 7 12 18 23 7"></polyline>
              </svg>
            </button>
            <div class="farama-header-menu-container farama-hidden" aria-hidden="true" id="farama-menu">
              <div class="farama-header-menu__header">
                <a href="https://farama.org">
                  <img class="farama-header-menu__logo farama-white-logo-invert" src="../_static/img/farama_solid_white.svg" alt="Farama Foundation logo">
                  <span>Farama Foundation</span>
                </a>
                <div class="farama-header-menu-header__right">
                  <button id="farama-close-menu">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"
                      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-close">
                      <line x1="3" y1="21" x2="21" y2="3"></line>
                      <line x1="3" y1="3" x2="21" y2="21"></line>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="farama-header-menu__body">
                <!-- Response from farama.org/api/projects.json -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<div class="page">
  <!--<header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../"><div class="brand">Stable-Retro Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>-->
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="farama-sidebar__title" href="../">
      <img class="farama-header__logo only-light" src="../_static/img/stable_retro_black.svg" alt="Light Logo"/>
      <img class="farama-header__logo only-dark" src="../_static/img/stable_retro_white.svg" alt="Dark Logo"/>
    <span class="farama-header__title">Stable-Retro Documentation</span>
  </a><form class="sidebar-search-container" method="get" action="../search/" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/">Development</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Game Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/">Python API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Farama-Foundation/StableRetro">Github</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Farama-Foundation/StableRetro/blob/main/docs/README.md">Contribute to the Docs</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main-container">

    

    

    <div class="main">
      <div class="content">
        <div class="article-container">
          <a href="#" class="back-to-top muted-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
            </svg>
            <span>Back to top</span>
          </a>
          <div class="content-icon-container"><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/Farama-Foundation/stable-retro/edit/master/docs/integration.md" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
              <button class="theme-toggle" title="Toggle color theme">
                <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
                <svg class="theme-icon-when-auto">
                  <use href="#svg-sun-half"></use>
                </svg>
                <svg class="theme-icon-when-dark">
                  <use href="#svg-moon"></use>
                </svg>
                <svg class="theme-icon-when-light">
                  <use href="#svg-sun"></use>
                </svg>
              </button>
            </div>
            <label class="toc-overlay-icon toc-content-icon" for="__toc">
              <div class="visually-hidden">Toggle table of contents sidebar</div>
              <i class="icon"><svg>
                  <use href="#svg-toc"></use>
                </svg></i>
            </label>
          </div>
          <article role="main">
            
            <section id="game-integration">
<h1>Game Integration<a class="headerlink" href="#game-integration" title="Link to this heading">#</a></h1>
<p>Integrating a game means taking a video game ROM file and setting it up as a reinforcement learning environment by defining 3 things:</p>
<ul class="simple">
<li><p>A starting state</p></li>
<li><p>A reward function</p></li>
<li><p>A done condition</p></li>
</ul>
<p>Once integrated, you will be able to use the game through the Python API as a <a class="reference external" href="https://gymnasium.farama.org/">Gymnasium</a> environment.</p>
<p>If you are going to integrate a new game, you’ll need a ROM for the correct system, see <a class="reference internal" href="#supported-roms"><span class="std std-ref">Supported ROM Types</span></a> for a list.</p>
<section id="example-integration">
<h2>Example Integration<a class="headerlink" href="#example-integration" title="Link to this heading">#</a></h2>
<p>This is a list of the integration files for the game <a class="reference external" href="https://github.com/farama-foundation/stable-retro/blob/master/retro/data/stable/Airstriker-Genesis">Airstriker-Genesis</a>.</p>
<section id="level1-state">
<h3><code class="docutils literal notranslate"><span class="pre">Level1.state</span></code><a class="headerlink" href="#level1-state" title="Link to this heading">#</a></h3>
<p>This is a savestate from the beginning of the game, restarting the environment will put the agent at this point in the game.</p>
</section>
<section id="data-json">
<h3><code class="docutils literal notranslate"><span class="pre">data.json</span></code><a class="headerlink" href="#data-json" title="Link to this heading">#</a></h3>
<p>This file defines the list of game-related variables that python can see based on their memory addresses in the games</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;gameover&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="mi">16712294</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;u2&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;lives&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="mi">16712282</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;u2&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="mi">16712270</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;u4&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="scenario-json">
<h3><code class="docutils literal notranslate"><span class="pre">scenario.json</span></code><a class="headerlink" href="#scenario-json" title="Link to this heading">#</a></h3>
<p>This file defines the reward function and done condition using the variables defined in <code class="docutils literal notranslate"><span class="pre">data.json</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;done&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;gameover&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="s2">&quot;equal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;reference&quot;</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="s2">&quot;lives&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="s2">&quot;zero&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;reward&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;reward&quot;</span><span class="p">:</span> <span class="mf">1.0</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="metadata-json">
<h3><code class="docutils literal notranslate"><span class="pre">metadata.json</span></code><a class="headerlink" href="#metadata-json" title="Link to this heading">#</a></h3>
<p>This file defines the default starting state if no state is specified by the user as well as some miscellaneous debugging information.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;default_state&quot;</span><span class="p">:</span> <span class="s2">&quot;Level1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;whitelist&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;data.json&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;suspicious type &gt;u2 for lives&quot;</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="rom-md">
<h3><code class="docutils literal notranslate"><span class="pre">rom.md</span></code><a class="headerlink" href="#rom-md" title="Link to this heading">#</a></h3>
<p>This is the ROM file used for this game, with a few exceptions, ROM files are not included in Stable Retro, but will be in your local copy of Stable Retro after you import them.</p>
</section>
<section id="rom-sha">
<h3><code class="docutils literal notranslate"><span class="pre">rom.sha</span></code><a class="headerlink" href="#rom-sha" title="Link to this heading">#</a></h3>
<p>This is the SHA1 hash of the <code class="docutils literal notranslate"><span class="pre">rom.md</span></code> file, used for importing ROMs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c67af162391fff4a63432be5a156eb9ca7b4da5a</span>
</pre></div>
</div>
<p>These are all the files used in an integration.  The next section will describe the files in more detail.</p>
</section>
</section>
<section id="integration-files">
<h2>Integration Files<a class="headerlink" href="#integration-files" title="Link to this heading">#</a></h2>
<section id="states">
<h3>States<a class="headerlink" href="#states" title="Link to this heading">#</a></h3>
<p>Emulation allows the entire state of a video game system to be stored to disk and restored. These files are specific to the emulator, but always end with <code class="docutils literal notranslate"><span class="pre">.state</span></code>. These are identical to the versions used in the standalone versions of the emulators but gzipped.</p>
</section>
<section id="variable-locations-data-json">
<h3>Variable Locations <code class="docutils literal notranslate"><span class="pre">data.json</span></code><a class="headerlink" href="#variable-locations-data-json" title="Link to this heading">#</a></h3>
<p>Information about the inner workings of games are stored alongside the ROM in a file named <code class="docutils literal notranslate"><span class="pre">data.json</span></code>. This JSON file documents “ground truth” information about a game, including the locations and formats of variables in memory. These manifests are separated into sections, although only one section currently is defined:</p>
<p>The <code class="docutils literal notranslate"><span class="pre">info</span></code> section of the manifest lists game variables’ memory addresses. Each entry in the <code class="docutils literal notranslate"><span class="pre">info</span></code> section consists of a key naming the memory address and the following values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">address</span></code>: The address into a RAM array of the first byte of the variable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: A type descriptor for this variable. See the above addendum for the format of this value.</p></li>
</ul>
<p>The following manifest shows an example of a game that has one variable, <code class="docutils literal notranslate"><span class="pre">score</span></code>, located at byte 128 that is 4 bytes wide in unsigned big endian format:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;info&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;score&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span>
<span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&gt;u4&quot;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information on the possible variable types, see <a class="reference internal" href="#appendix-types"><span class="std std-ref">Appendix: Types</span></a>.</p>
</section>
<section id="scenario-scenario-json">
<h3>Scenario <code class="docutils literal notranslate"><span class="pre">scenario.json</span></code><a class="headerlink" href="#scenario-scenario-json" title="Link to this heading">#</a></h3>
<p>Information pertaining to reward functions and done conditions can either be specified by manually overriding functions in <code class="xref py py-class docutils literal notranslate"><span class="pre">retro.RetroEnv</span></code> or can be done by writing a scenario file.</p>
<p>Scenario files contain information that is used to compute the reward function and done condition from variables defined in the information manifest. Each variable specified in the scenario file is multiplied by a <code class="docutils literal notranslate"><span class="pre">reward</span></code> value if positive and a <code class="docutils literal notranslate"><span class="pre">penalty</span></code> value if negative and then summed up to create the reward for that step. Similarly, states of these variables can be checked to see if the game is over. By default the scenario file will be loaded from <code class="docutils literal notranslate"><span class="pre">scenario.json</span></code>, but alternative scenario files can be specified in the <code class="xref py py-class docutils literal notranslate"><span class="pre">retro.RetroEnv</span></code> constructor.</p>
<p>Scenario files are again JSON and specified with the following sections:</p>
<p>The <code class="docutils literal notranslate"><span class="pre">reward</span></code> section used to calculate the reward function, and it split into the following subsections:</p>
<p>The <code class="docutils literal notranslate"><span class="pre">variables</span></code> subsection is used for defining how to calculate the reward function from the current state of memory. For each variable in the <code class="docutils literal notranslate"><span class="pre">variables</span></code> section, a value is calculated, multiplied by a coefficient, then added to the reward function for this step. How a value is extracted is specified by the <code class="docutils literal notranslate"><span class="pre">op</span></code>/<code class="docutils literal notranslate"><span class="pre">measurement</span></code>/<code class="docutils literal notranslate"><span class="pre">reference</span></code> values (see the addendum below on operations for the meanings of these). The default <code class="docutils literal notranslate"><span class="pre">measurement</span></code> is <code class="docutils literal notranslate"><span class="pre">delta</span></code>. There is no default <code class="docutils literal notranslate"><span class="pre">op</span></code>, and by default the value is passed through raw.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">reward</span></code>: A coefficient multiplied by the value when the value is positive.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">penalty</span></code>: A coefficient multiplied by the value when the value is negative.</p></li>
</ul>
<p>A negative <code class="docutils literal notranslate"><span class="pre">penalty</span></code> would imply addition to the reward function instead of subtraction as the value to be multiplied by the coefficient is negative.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">time</span></code> subsection is used for creating rewards based off of how many steps are taken. Two values can be specified:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">reward</span></code>: A value to be added to the reward function every step.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">penalty</span></code>: A value to be subtracted from the reward function every step.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">done</span></code> section is used to calculate if the end of a game has been reached. At the top level the following property is available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: Specifies how the <code class="docutils literal notranslate"><span class="pre">done</span></code> conditions should be combined
- <code class="docutils literal notranslate"><span class="pre">any</span></code>: Any of the conditions in the <code class="docutils literal notranslate"><span class="pre">done</span></code> section is fulfilled. This is the default.
- <code class="docutils literal notranslate"><span class="pre">all</span></code>: All of the conditions in the <code class="docutils literal notranslate"><span class="pre">done</span></code> section are fulfilled.</p></li>
</ul>
<p>Currently it has one subsection:</p>
<p>The <code class="docutils literal notranslate"><span class="pre">variables</span></code> subsection specifies how to calculate the done condition from the current state of memory. Each variable in the <code class="docutils literal notranslate"><span class="pre">variables</span></code> subsection is extracted per the <code class="docutils literal notranslate"><span class="pre">op</span></code>/<code class="docutils literal notranslate"><span class="pre">measurement</span></code>/<code class="docutils literal notranslate"><span class="pre">reference</span></code> values (see the addendum below on operations for the meanings of these). The default <code class="docutils literal notranslate"><span class="pre">measurement</span></code> is <code class="docutils literal notranslate"><span class="pre">absolute</span></code>. There is no default <code class="docutils literal notranslate"><span class="pre">op</span></code>, and by default the value is ignored.</p>
<p>For more information on the conditions that can be defined, see <a class="reference internal" href="#appendix-operations"><span class="std std-ref">Appendix: Operations</span></a>.</p>
</section>
</section>
<section id="the-integration-ui">
<span id="integration-ui"></span><h2>The Integration UI<a class="headerlink" href="#the-integration-ui" title="Link to this heading">#</a></h2>
<p>The integration UI helps you easily find variables and see what is going on with the reward function.</p>
<p>You can normally download the compiled UI package for your platform here:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#TODO"><span class="xref myst">Windows Integration UI</span></a></p></li>
<li><p><a class="reference internal" href="#TODO"><span class="xref myst">Mac Integration UI</span></a></p></li>
</ul>
<p>However, if those URLs no longer work, you can also download these packages from <a class="reference external" href="https://github.com/farama-foundation/stable-retro/releases/">GitHub’s Releases</a></p>
<section id="integrating-a-new-rom">
<h3>Integrating a new ROM<a class="headerlink" href="#integrating-a-new-rom" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Open the Stable Retro Integration UI</p></li>
<li><p>Load a new game — <code class="docutils literal notranslate"><span class="pre">Command-Shift-O</span></code> on Mac</p></li>
<li><p>Select the ROM of the game you’d like to integrate in the menu</p></li>
<li><p>Name the game</p></li>
<li><p>The game will open. To see what keys correspond to what controls in-game, go to Window &gt; Control</p></li>
<li><p>Using the available controls, select a level, option, mode, character, etc. and take note of these options</p></li>
<li><p>When you are finally at the first playable moment of the game, pause the game (in the integrator, not within the actual game) (<code class="docutils literal notranslate"><span class="pre">Command-P</span></code>), and save the state (<code class="docutils literal notranslate"><span class="pre">Command-S</span></code>). This moment can be hard to find, and you might have to go back through and restart the game (<code class="docutils literal notranslate"><span class="pre">Command-R</span></code>) to find and save that exact state.</p></li>
<li><p>Save the state — include the options you chose in the previous menus — e.g. <code class="docutils literal notranslate"><span class="pre">SailorMoon.QueenBerylsCastle.Easy.Level1.state</span></code></p></li>
</ol>
<p>For Stable Retro integrations, a few notes about ROMs:</p>
<ul class="simple">
<li><p>We have preferred the USA version of ROMs, denoted by one of <code class="docutils literal notranslate"><span class="pre">(USA)</span></code>, <code class="docutils literal notranslate"><span class="pre">(USA,</span> <span class="pre">Europe)</span></code>, <code class="docutils literal notranslate"><span class="pre">(Japan,</span> <span class="pre">USA)</span></code>, etc</p></li>
<li><p>If the ROM has a <code class="docutils literal notranslate"><span class="pre">.bin</span></code> extension, rename it to have the correct extension for that system listed in <a class="reference internal" href="#supported-roms"><span class="std std-ref">Supported ROM Types</span></a></p></li>
<li><p>Use the Stable Retro Integration application and select the Integrate option from the File menu to begin working on integrating it</p></li>
</ul>
</section>
</section>
<section id="supported-rom-types">
<span id="supported-roms"></span><h2>Supported ROM Types<a class="headerlink" href="#supported-rom-types" title="Link to this heading">#</a></h2>
<p>ROM files contain the game itself. Each system has a unique file extension to denote which system a given ROM runs on:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.md</span></code>: Sega Genesis (also known as Mega Drive)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.sfc</span></code>: Super Nintendo Entertainment System (also known as Super Famicom)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.nes</span></code>: Nintendo Entertainment System (also known as Famicom)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.a26</span></code>: Atari 2600</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.gb</span></code>: Nintendo Game Boy</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.gba</span></code>: Nintendo Game Boy Advance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.gbc</span></code>: Nintendo Game Boy Color</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.gg</span></code>: Sega Game Gear</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.pce</span></code>: NEC TurboGrafx-16 (also known as PC Engine)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.sms</span></code>: Sega Master System</p></li>
</ul>
<p>Sometimes ROMs from these systems use different extensions, e.g. <code class="docutils literal notranslate"><span class="pre">.gen</span></code> for Genesis, <code class="docutils literal notranslate"><span class="pre">.bin</span></code> for Atari, etc. Please rename the ROMs to use the aforementioned extensions in these cases.</p>
</section>
<section id="integrating-a-game">
<h2>Integrating a Game<a class="headerlink" href="#integrating-a-game" title="Link to this heading">#</a></h2>
<p>To integrate a game you need to define a done condition and a reward function.  The done condition lets Stable Retro know when to end a game session, while the reward function provides a simple numeric goal for machine learning agents to maximize.</p>
<p>To define these, you find variables from the game’s memory, such as the player’s current score and lives remaining, and use those to create the done condition and reward function.  An example done condition is when the <code class="docutils literal notranslate"><span class="pre">lives</span></code> variable is equal to <code class="docutils literal notranslate"><span class="pre">0</span></code>, an example reward function is the change in the <code class="docutils literal notranslate"><span class="pre">score</span></code> variable.</p>
<p>Note: if the game requires that you hit the <code class="docutils literal notranslate"><span class="pre">Start</span></code> button to play, for instance after dying, then you need to modify the scenario file to allow this as <code class="docutils literal notranslate"><span class="pre">Start</span></code> is disallowed by default.  See the <code class="docutils literal notranslate"><span class="pre">actions</span></code> key in <a class="reference external" href="https://github.com/farama-foundation/stable-retro/blob/master/retro/data/stable/KidChameleon-Genesis/scenario.json">KidChameleon-Genesis</a> for an example of this.</p>
<section id="done-condition">
<h3>Done Condition<a class="headerlink" href="#done-condition" title="Link to this heading">#</a></h3>
<p>This is usually the easier of the two.  The best done condition to use is the Game Over or Continue screen after you run out of lives.  For some games this is when you have zero lives left, for some <code class="docutils literal notranslate"><span class="pre">-1</span></code> lives, for others, it can be pretty hard.</p>
<p>It’s better to have a simple and reliable but slightly incorrect done condition (e.g. ending the game when you still have 1 life left because it’s hard to detect the 0 life case) than to have a done condition that is unreliable, such as a <code class="docutils literal notranslate"><span class="pre">gameover</span></code> variable that detects when the gameover screen is present most of the time but also incorrectly fires when switching levels.</p>
<p>If you create a <code class="docutils literal notranslate"><span class="pre">gameover</span></code> variable, make sure to test it with a replay that plays multiple levels in a row to make sure it doesn’t fire accidentally.</p>
</section>
<section id="reward-function">
<h3>Reward Function<a class="headerlink" href="#reward-function" title="Link to this heading">#</a></h3>
<p>Reinforcement learning agents try to maximize the reward function.  The ideal reward function would be that you get 1 point for beating the game.  There’s no way to maximize that besides beating the game.</p>
<p>That reward is impractical though, because existing reinforcement learning algorithms are unable to make progress with a reward that is so hard to get.  Instead we can specify some easier to get reward that, if you maximize it, should result in beating the game.</p>
<p>If the game has a score, this is often a good choice.  In some games however, you can get as much score as you want by standing in one place and attacking the same enemy over and over as it respawns.  Because that is so different from beating the game, it’s best to have an alternative reward, though these are often very game specific.</p>
<p>Be careful with non-score variables though, they can be tricky to get right, make sure to play multiple levels using the reward to see if it makes sense.</p>
<p>Provided you use the score, define a <code class="docutils literal notranslate"><span class="pre">score</span></code> variable and set the reward such that the reward the agent receives matches the score displayed on the screen, make sure to check that you’re not off by a factor of 10 or 100 by comparing to the <code class="docutils literal notranslate"><span class="pre">Cumulative</span></code> value displayed in the <code class="docutils literal notranslate"><span class="pre">Scenario</span> <span class="pre">Information</span></code> pane of the UI.</p>
</section>
<section id="finding-variables">
<h3>Finding Variables<a class="headerlink" href="#finding-variables" title="Link to this heading">#</a></h3>
<p>It’s best to keep a consistent pattern for the different types of variables you might add to a game’s <code class="docutils literal notranslate"><span class="pre">data.json</span></code> file.  Here are some tips:</p>
<ol class="arabic simple">
<li><p>It’s pretty common for multiple different variables to group themselves together. When narrowing down the search for a particular variable, look at nearby memory addresses if you suspect you have a similar but incorrect variable (for instance you found the high score variable but are looking for the score variable).</p></li>
<li><p>Score occasionally is stored in individual locations — e.g. if the score displayed is <code class="docutils literal notranslate"><span class="pre">123400</span></code>, 1, 2, 3, 4, 0, 0 all will update separately.  If the score is broken into multiple variables, make sure you have penalties set for the individual digits (such as <a class="reference external" href="https://github.com/openai/retro/blob/master/retro/data/stable/BOB-Snes/scenario.json">BOB-Snes</a>). A number of games will update the score value across multiple frames, in this case you will need a lua script to correct the reward, such as <a class="reference external" href="https://github.com/openai/retro/blob/master/retro/data/stable/1942-Nes/script.lua">1942-Nes</a>.</p></li>
<li><p>Check for uncommon lengths of 3, 5, etc. Games don’t always store score in nice neat lengths of multiples of 2, and making sure the variable is the appropriate length is key — if you go too short, then no progress over a certain score is tracked, if you go too long, then the score can suddenly jump between levels, etc.  If you can’t decide between two possible lengths, the shorter length is the safer bet.</p></li>
<li><p>Score variable doesn’t always include the 0s at the end of the game — while the screen might say <code class="docutils literal notranslate"><span class="pre">2400</span></code>, the score variable might only store <code class="docutils literal notranslate"><span class="pre">24</span></code>.  So you will need to multiply by 100 in this case.</p></li>
<li><p>It’s very uncommon, but occasionally, scores can be transposed by a value of 1 — e.g., while the screen says <code class="docutils literal notranslate"><span class="pre">123456</span></code>, the variable is <code class="docutils literal notranslate"><span class="pre">012345</span></code>. Some of these scores start at -1 rather than 0. This can be fixed with lua.</p></li>
<li><p>It’s very uncommon, but some games track health symbolically rather than with one set #. For example, the starting health bar could be represented by <code class="docutils literal notranslate"><span class="pre">9999999</span></code>, which displays as a full health bar, but becomes <code class="docutils literal notranslate"><span class="pre">99999</span></code> after losing two health units.</p></li>
<li><p>In defining a game over variable, look for a binary value that switches between 0 and 1 – 0 when the game is in play, 1 when the game is over.  And make sure to test it by playing a few consecutive levels.</p></li>
</ol>
<p>Once you’ve found a variable, making sure the address and type are correct is important for avoiding issues later.  One of the best ways to do this is to change the value in memory, then change it in the game and make sure it updates correctly.</p>
<p>For instance if you have a variable called “score” and you want to see if it is <code class="docutils literal notranslate"><span class="pre">&gt;d2</span></code> or <code class="docutils literal notranslate"><span class="pre">&gt;d4</span></code>, set the type to <code class="docutils literal notranslate"><span class="pre">&gt;d4</span></code> and set the value to the maximum for <code class="docutils literal notranslate"><span class="pre">&gt;d2</span></code>, 9999, and then increase the score by playing the game.  If the score increases by 1, and the value in the memory viewer is 10000 and the value in the game is 10000, then <code class="docutils literal notranslate"><span class="pre">&gt;d4</span></code> is correct.  If the value in the memory viewer or game is 0 or 9999, then it’s likely that <code class="docutils literal notranslate"><span class="pre">&gt;d2</span></code> is the correct type or that the address is wrong. You may also want to check if &gt;d3 is the correct type by changing the score to 999999 and playing for a bit.</p>
<p>You can also check to see if the data type is correct by watching how it increments and decrements in the search window as you play the game. For example, if the value of the variable jumps from <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">255</span></code>, it’s likely that this is a signed value (represented by <code class="docutils literal notranslate"><span class="pre">i</span></code>) – unsigned values (represented by <code class="docutils literal notranslate"><span class="pre">u</span></code>) are either positive or zero.</p>
<p>When you search for a variable, different formats at the same location will appear next to each other in the search window. For example, at address <code class="docutils literal notranslate"><span class="pre">16769105</span></code>, you might see <code class="docutils literal notranslate"><span class="pre">&gt;u2</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;i2</span></code>, as well as <code class="docutils literal notranslate"><span class="pre">&gt;d2</span></code> return as search results. Play the game for a little bit, and you might notice that one of the search results increments/decrements in uneven or unusual ways in relation to the other search results at the same address.</p>
<p>eg: <code class="docutils literal notranslate"><span class="pre">|u1</span></code> at <code class="docutils literal notranslate"><span class="pre">7e094d</span></code> goes from <code class="docutils literal notranslate"><span class="pre">144</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">137</span></code>, <code class="docutils literal notranslate"><span class="pre">|d1</span></code> at <code class="docutils literal notranslate"><span class="pre">7e094d</span></code> (same address) decrements from <code class="docutils literal notranslate"><span class="pre">90</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">89</span></code>, it’s probably <code class="docutils literal notranslate"><span class="pre">|d1</span></code></p>
<p>If you update the value of a variable but it doesn’t have any effect on the game, it’s likely that you’ve found a copy of the variable, not the correct address.  An example would be a lives variable, but setting it to some higher value and then dying in the game reveals that you didn’t actually increase the number of lives.  It’s often the case that you have to change the value in the game to get things to update (such as losing a life in the previous example).</p>
<p>Ideally you can find the original since it’s more likely to be correct, so if you can, find a variable that when updated, updates the corresponding value in the game.  The most common source of this is a high score variable which will have the same value as the normal score variable, but updating it will have no effect on your score.</p>
</section>
<section id="common-errors">
<h3>Common Errors<a class="headerlink" href="#common-errors" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Wrong type for variable: if your score variable is actually <code class="docutils literal notranslate"><span class="pre">&gt;d2</span></code> and you put <code class="docutils literal notranslate"><span class="pre">&gt;d4</span></code>, you may not notice until you get to some later level and the memory address next to the score is used for something, suddenly giving you a very large score.</p></li>
<li><p>Incorrect done condition: it might be that if you run out of time or die in some unusual way that the done condition is not detected correctly.  Make sure to test unusual ways of ending the game, and make sure that your done condition doesn’t fire upon completing a level (unless it’s the final level of the game).  If you’re able to hit continue after dying, make sure that the game ends before the agent can hit continue.</p></li>
<li><p>Score is used as reward, but it’s different from the score displayed in the game: this could happen if you forgot a factor of 10 in the reward, or if you’re calculating the score based on some other variables (e.g. the upper and lower digits of the score, or some variable like <code class="docutils literal notranslate"><span class="pre">number</span> <span class="pre">of</span> <span class="pre">enemies</span> <span class="pre">killed</span> <span class="pre">*</span> <span class="pre">100</span></code>) and there is a bug.  If you play the game for awhile and the reward diverges slightly from the in-game score, it’s possible that the score digits are not always updated at the same time.  In this case, you can use the change in maximum score as the reward, see <a class="reference external" href="https://github.com/openai/retro/blob/master/retro/data/stable/GuardianLegend-Nes/script.lua">GuardianLegend-Nes</a> for an example of this.</p></li>
</ul>
</section>
</section>
<section id="using-a-custom-integration-from-python">
<h2>Using a Custom Integration from Python<a class="headerlink" href="#using-a-custom-integration-from-python" title="Link to this heading">#</a></h2>
<p>Once you have created an integration, you can put it in a folder called <code class="docutils literal notranslate"><span class="pre">custom_integrations</span></code>. In particular, your integration directory name should follow the following structure (depending on the rom type):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.md</span></code>: <code class="docutils literal notranslate"><span class="pre">*-Genesis</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">AddamsFamily-Genesis</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.sfc</span></code>: <code class="docutils literal notranslate"><span class="pre">*-Snes</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">AddamsFamily-Snes</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.nes</span></code>: <code class="docutils literal notranslate"><span class="pre">*-Nes</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">AddamsFamily-Nes</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.a26</span></code>: <code class="docutils literal notranslate"><span class="pre">*-Atari2600</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">Adventure-Atari2600</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.gb</span></code>: <code class="docutils literal notranslate"><span class="pre">*-GameBoy</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">AeroStar-GameBoy</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.gba</span></code>: <code class="docutils literal notranslate"><span class="pre">*-GbAdvance</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">MarioKart-GbAdvance</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.gbc</span></code>: <code class="docutils literal notranslate"><span class="pre">*-GbColor</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">PokemonPinball-GbColor</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.gg</span></code>: <code class="docutils literal notranslate"><span class="pre">*-GameGear</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">MortalKombat-GameGear</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.pce</span></code>: <code class="docutils literal notranslate"><span class="pre">*-PCEngine</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">SoldierBlade-PCEngine</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.sms</span></code>: <code class="docutils literal notranslate"><span class="pre">*-Sms</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">AddamsFamily-Sms</span></code>)</p></li>
</ul>
<p>Then you can tell <code class="docutils literal notranslate"><span class="pre">retro</span></code> about your custom integration using the <code class="docutils literal notranslate"><span class="pre">add_custom_path</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">retro</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">SCRIPT_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
        <span class="n">retro</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Integrations</span><span class="o">.</span><span class="n">add_custom_path</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SCRIPT_DIR</span><span class="p">,</span> <span class="s2">&quot;custom_integrations&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FakeGame-Nes&quot;</span> <span class="ow">in</span> <span class="n">retro</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">list_games</span><span class="p">(</span><span class="n">inttype</span><span class="o">=</span><span class="n">retro</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Integrations</span><span class="o">.</span><span class="n">ALL</span><span class="p">))</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">retro</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">&quot;FakeGame-Nes&quot;</span><span class="p">,</span> <span class="n">inttype</span><span class="o">=</span><span class="n">retro</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Integrations</span><span class="o">.</span><span class="n">ALL</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>This lets you use your integration without having to add it to <code class="docutils literal notranslate"><span class="pre">retro</span></code> directly.</p>
</section>
<section id="appendix-types">
<span id="id1"></span><h2>Appendix: Types<a class="headerlink" href="#appendix-types" title="Link to this heading">#</a></h2>
<p>The types consist of three parts, in order:</p>
<ul class="simple">
<li><p>Endianness</p></li>
<li><p>Format</p></li>
<li><p>Bytes</p></li>
</ul>
<p>Endianness refers to the order of the bytes in memory.
For example, take the hex string <code class="docutils literal notranslate"><span class="pre">0x01020304</span></code>, which can be stored many ways:</p>
<blockquote>
<div><ul class="simple">
<li><p>Big endian: <code class="docutils literal notranslate"><span class="pre">0x01</span> <span class="pre">0x02</span> <span class="pre">0x03</span> <span class="pre">0x04</span></code></p></li>
<li><p>Little endian: <code class="docutils literal notranslate"><span class="pre">0x04</span> <span class="pre">0x03</span> <span class="pre">0x02</span> <span class="pre">0x01</span></code></p></li>
<li><p>Middle endian (big outside/little inside): <code class="docutils literal notranslate"><span class="pre">0x02</span> <span class="pre">0x01</span> <span class="pre">0x04</span> <span class="pre">0x03</span></code></p></li>
<li><p>Middle endian (little outside/big inside): <code class="docutils literal notranslate"><span class="pre">0x03</span> <span class="pre">0x04</span> <span class="pre">0x01</span> <span class="pre">0x02</span></code></p></li>
</ul>
</div></blockquote>
<p>The following sigils correspond to the endiannesses:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;</span></code>: Little</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;</span></code>: Big</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;&lt;</span></code>: Middle (big/little)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code>: Middle (little/big)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">=</span></code>: Native (little on most computers)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>: Middle (big/native)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>: Middle (little/native)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code>: Don’t care (only useful for single-byte values)</p></li>
</ul>
</div></blockquote>
<p><em>NB</em>: Middle endian is very rare, but some systems store 16-bit values in
native endian and 32-bit values as two 16-bit values in big endian order.
One such example is the emulator Genesis Plus GX. Thus, on a big endian
system the format appears to be <code class="docutils literal notranslate"><span class="pre">=u4</span></code> (aka <code class="docutils literal notranslate"><span class="pre">&gt;u4</span></code>) when it appears as <code class="docutils literal notranslate"><span class="pre">&gt;=u4</span></code>
on little endian systems. As such some data may require manual grooming.</p>
<p>Format refers to how in memory a value is stored.
For example, take the hex byte <code class="docutils literal notranslate"><span class="pre">0x81</span></code>. It could mean three things in decimal:</p>
<blockquote>
<div><ul class="simple">
<li><p>Unsigned: 129</p></li>
<li><p>Signed: -127</p></li>
<li><p>Binary-coded decimal: 81</p></li>
<li><p>Low-nybble Binary-coded decimal: 1</p></li>
</ul>
</div></blockquote>
<p><em>NB</em>: The nybbles <code class="docutils literal notranslate"><span class="pre">0xA</span></code> - <code class="docutils literal notranslate"><span class="pre">0xF</span></code> cannot occur in binary-coded decimal.</p>
<p>The following characters correspond to formats:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">i</span></code>: Signed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">u</span></code>: Unsigned</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">d</span></code>: Binary-coded Decimal</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n</span></code>: Low-nybble Binary-coded Decimal</p></li>
</ul>
</div></blockquote>
<p>Finally, the last piece refers to how many bytes a value occupies in memory.
Ideally, this should be a power of two, e.g. 1, 2, 4, 8, etc., however non-power of two values are used by some games (e.g. the score in Super Mario Bros. is 6 bytes long), so non-power of two variables are supported.</p>
<p><em>NB</em>: Native endian and middle endian don’t work with non-power of two sizes or sizes less than 4 bytes. Currently only 4-byte middle endian is properly supported.</p>
<p>Some examples follow:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;u2</span></code>: Little endian two-byte unsigned value
(i.e. <code class="docutils literal notranslate"><span class="pre">0x0102</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">0x02</span> <span class="pre">0x01</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;&gt;u4</span></code>: Middle endian (little/big) four-byte unsigned value
(i.e. <code class="docutils literal notranslate"><span class="pre">0x01020304</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">0x03</span> <span class="pre">0x04</span> <span class="pre">0x01</span> <span class="pre">0x02</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;d2</span></code>: Big endian two-byte binary-coded decimal value
(i.e. <code class="docutils literal notranslate"><span class="pre">1234</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">0x12</span> <span class="pre">0x34</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">|u1</span></code>: Single unsigned byte</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;u3</span></code>: Non-power of two bytes
(i.e. <code class="docutils literal notranslate"><span class="pre">0x010203</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">0x03</span> <span class="pre">0x02</span> <span class="pre">0x1</span></code>)</p></li>
<li><p>=n2: Native endian two-byte low-nybble binary-coded decimal value
(i.e. <code class="docutils literal notranslate"><span class="pre">12</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">0x01</span> <span class="pre">0x02</span></code> on Intel and most ARM CPUs, <code class="docutils literal notranslate"><span class="pre">0x02</span> <span class="pre">0x01</span></code> on PowerPC CPUs)</p></li>
</ul>
</div></blockquote>
<p>Some non-examples:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">|i2</span></code>: Valid but not recommended: Two signed bytes, order undefined</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;u1</span></code>: Valid but not recommended: One byte has no order</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">?u4</span></code>: Invalid: undefined endianness</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;q2</span></code>: Invalid: undefined format</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">=i0</span></code>: Invalid: zero bytes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;&lt;u3</span></code>: Invalid: Non-power of two middle endian bytes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;=u2</span></code>: Invalid: Middle endian does not make sense for two byte values</p></li>
</ul>
</div></blockquote>
</section>
<section id="appendix-operations">
<span id="id2"></span><h2>Appendix: Operations<a class="headerlink" href="#appendix-operations" title="Link to this heading">#</a></h2>
<p>Games can store information in memory in many various ways, and as such the specific information needed can vary in form too. The basic premise is that once a raw value is extracted from memory an operation may be defined to transform it to a useful form. Furthermore, we may want raw values in a given step or the deltas between two steps. Thus three properties are defined:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">measurement</span></code>: The method used for extracting the raw value. May be <code class="docutils literal notranslate"><span class="pre">absolute</span></code> for the current value and <code class="docutils literal notranslate"><span class="pre">delta</span></code> for the difference between the current and previous value. The default varies based on context.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">op</span></code>: The specific operation to apply to this value. Valid operations are defined below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reference</span></code>: The reference value for an operation, if needed.</p></li>
</ul>
<p>The following operations are defined:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nonzero</span></code>: Returns 0 if the value is 0, 1 otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zero</span></code>: Returns 1 if the value is 0, 0 otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">positive</span></code>: Returns 1 if the value is positive, 0 otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negative</span></code>: Returns 1 if the value is negative, 0 otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sign</span></code>: Returns 1 if the value is positive, -1 if the value is negative, 0 otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">equal</span></code>: Returns 1 if the value is equal to the <code class="docutils literal notranslate"><span class="pre">reference</span></code> value, 0 otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">not-equal</span></code>: Returns 1 if the value is not equal to the <code class="docutils literal notranslate"><span class="pre">reference</span></code> value, 0 otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">less-than</span></code>: Returns 1 if the value is less than the <code class="docutils literal notranslate"><span class="pre">reference</span></code> value, 0 otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">greater-than</span></code>: Returns 1 if the value is greater than the <code class="docutils literal notranslate"><span class="pre">reference</span></code> value, 0 otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">less-or-equal</span></code>: Returns 1 if the value is less than or equal to the <code class="docutils literal notranslate"><span class="pre">reference</span></code> value, 0 otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">greater-or-equal</span></code>: Returns 1 if the value is greater than or equal to the <code class="docutils literal notranslate"><span class="pre">reference</span></code> value, 0 otherwise.</p></li>
</ul>
</section>
</section>

          </article>
        </div>
        <footer>
          
          <div class="related-pages">
            <a class="next-page" href="../python/">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Python API</div>
              </div>
              <svg class="furo-related-icon">
                <use href="#svg-arrow-right"></use>
              </svg>
            </a>
            <a class="prev-page" href="../developing/">
              <svg class="furo-related-icon">
                <use href="#svg-arrow-right"></use>
              </svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Development</div>
                
              </div>
            </a>
          </div>
          <div class="bottom-of-page">
            <div class="left-details">
              <div class="copyright">
                Copyright &#169; 2023 Farama Foundation
              </div>
              <!--
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            -->
            </div>
            <div class="right-details">
              <div class="icons">
                <a class="muted-link" href="https://github.com/Farama-Foundation/stable-retro/"
                  aria-label="On GitHub">
                  <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                      d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z">
                    </path>
                  </svg>
                </a>
              </div>
            </div>
          </div>
          
        </footer>
      </div>
      <aside class="toc-drawer">
        
        
        <div class="toc-sticky toc-scroll">
          <div class="toc-title-container">
            <span class="toc-title">
              On this page
            </span>
          </div>
          <div class="toc-tree-container">
            <div class="toc-tree">
              <ul>
<li><a class="reference internal" href="#">Game Integration</a><ul>
<li><a class="reference internal" href="#example-integration">Example Integration</a><ul>
<li><a class="reference internal" href="#level1-state"><code class="docutils literal notranslate"><span class="pre">Level1.state</span></code></a></li>
<li><a class="reference internal" href="#data-json"><code class="docutils literal notranslate"><span class="pre">data.json</span></code></a></li>
<li><a class="reference internal" href="#scenario-json"><code class="docutils literal notranslate"><span class="pre">scenario.json</span></code></a></li>
<li><a class="reference internal" href="#metadata-json"><code class="docutils literal notranslate"><span class="pre">metadata.json</span></code></a></li>
<li><a class="reference internal" href="#rom-md"><code class="docutils literal notranslate"><span class="pre">rom.md</span></code></a></li>
<li><a class="reference internal" href="#rom-sha"><code class="docutils literal notranslate"><span class="pre">rom.sha</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#integration-files">Integration Files</a><ul>
<li><a class="reference internal" href="#states">States</a></li>
<li><a class="reference internal" href="#variable-locations-data-json">Variable Locations <code class="docutils literal notranslate"><span class="pre">data.json</span></code></a></li>
<li><a class="reference internal" href="#scenario-scenario-json">Scenario <code class="docutils literal notranslate"><span class="pre">scenario.json</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-integration-ui">The Integration UI</a><ul>
<li><a class="reference internal" href="#integrating-a-new-rom">Integrating a new ROM</a></li>
</ul>
</li>
<li><a class="reference internal" href="#supported-rom-types">Supported ROM Types</a></li>
<li><a class="reference internal" href="#integrating-a-game">Integrating a Game</a><ul>
<li><a class="reference internal" href="#done-condition">Done Condition</a></li>
<li><a class="reference internal" href="#reward-function">Reward Function</a></li>
<li><a class="reference internal" href="#finding-variables">Finding Variables</a></li>
<li><a class="reference internal" href="#common-errors">Common Errors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-a-custom-integration-from-python">Using a Custom Integration from Python</a></li>
<li><a class="reference internal" href="#appendix-types">Appendix: Types</a></li>
<li><a class="reference internal" href="#appendix-operations">Appendix: Operations</a></li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
        
        
      </aside>
    </div>
  </div>
</div>
    <script>
      const toggleMenu = () => {
        const menuBtn = document.querySelector(".farama-header-menu__btn");
        const menuContainer = document.querySelector(".farama-header-menu-container");
        if (document.querySelector(".farama-header-menu").classList.contains("active")) {
          menuBtn.setAttribute("aria-expanded", "false");
          menuContainer.setAttribute("aria-hidden", "true");
        } else {
          menuBtn.setAttribute("aria-expanded", "true");
          menuContainer.setAttribute("aria-hidden", "false");
        }
        document.querySelector(".farama-header-menu").classList.toggle("active");
      }

      document.querySelector(".farama-header-menu__btn").addEventListener("click", toggleMenu);
      document.getElementById("farama-close-menu").addEventListener("click", toggleMenu);
    </script>

    
    

    <script src="../_static/documentation_options.js?v=27f13642"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=7660844c"></script>
    
    <script>

      const createProjectsList = (projects, displayImages) => {
        const ulElem = Object.assign(document.createElement('ul'),
          {
            className:'farama-header-menu-list',
          }
        )
        for (let project of projects) {
          const liElem = document.createElement("li");
          const aElem = Object.assign(document.createElement("a"),
            {
              href: project.link
            }
          );
          liElem.appendChild(aElem);
          if (displayImages) {
            const imgElem = Object.assign(document.createElement("img"),
              {
                src: project.image ? imagesBasepath + project.image : imagesBasepath + "/farama_black.svg",
                alt: `${project.name} logo`,
                className: "farama-black-logo-invert"
              }
            );
            aElem.appendChild(imgElem);
          }
          aElem.appendChild(document.createTextNode(project.name));
          ulElem.appendChild(liElem);
        }
        return ulElem;
      }

      // Create menu with Farama projects by using the API at farama.org/api/projects.json
      const createCORSRequest = (method, url) => {
        let xhr = new XMLHttpRequest();
        xhr.responseType = 'json';

        if ("withCredentials" in xhr) {
          xhr.open(method, url, true);
        } else if (typeof XDomainRequest != "undefined") {
          // IE8 & IE9
          xhr = new XDomainRequest();
          xhr.open(method, url);
        } else {
          // CORS not supported.
          xhr = null;
        }
        return xhr;
      };

      const url = 'https://farama.org/api/projects.json';
      const imagesBasepath = "https://farama.org/assets/images"
      const method = 'GET';
      let xhr = createCORSRequest(method, url);

      xhr.onload = () => {
        const jsonResponse = xhr.response;
        const sections = {
          "Core Projects": [],
          "Mature Projects": {
            "Documentation": [],
            "Repositories": [],
          },
          "Incubating Projects": {
            "Documentation": [],
            "Repositories": [],
          },
          "Foundation": [
            {
              name: "About",
              link: "https://farama.org/about"
            },
            {
              name: "Standards",
              link: "https://farama.org/project_standards",
            },
            {
              name: "Donate",
              link: "https://farama.org/donations"
            }
          ]
        }

        // Categorize projects
        Object.keys(jsonResponse).forEach(key => {
          projectJson = jsonResponse[key];
          if (projectJson.website !== null) {
            projectJson.link = projectJson.website;
          } else {
            projectJson.link = projectJson.github;
          }
          if (projectJson.type === "core") {
            sections["Core Projects"].push(projectJson)
          } else if (projectJson.type == "mature") {
            if (projectJson.website !== null) {
              sections["Mature Projects"]["Documentation"].push(projectJson)
            } else {
              sections["Mature Projects"]["Repositories"].push(projectJson)
            }
          } else {
            if (projectJson.website !== null) {
              sections["Incubating Projects"]["Documentation"].push(projectJson)
            } else {
              sections["Incubating Projects"]["Repositories"].push(projectJson)
            }
          }
        })

        const menuContainer = document.querySelector(".farama-header-menu__body");

        Object.keys(sections).forEach((key, i) => {
          const sectionElem = Object.assign(
            document.createElement('div'), {
              className:'farama-header-menu__section',
            }
          )
          sectionElem.appendChild(Object.assign(document.createElement('span'),
            {
              className:'farama-header-menu__section-title' ,
              innerText: key
            }
          ))
          // is not a list
          if (sections[key].constructor !== Array) {
            const subSections = sections[key];
            const subSectionContainerElem = Object.assign(
                document.createElement('div'), {
                  className:'farama-header-menu__subsections-container',
                  style: 'display: flex'
                }
            )
            Object.keys(subSections).forEach((subKey, i) => {
              const subSectionElem = Object.assign(
                document.createElement('div'), {
                  className:'farama-header-menu__subsection',
                }
              )
              subSectionElem.appendChild(Object.assign(document.createElement('span'),
                {
                  className:'farama-header-menu__subsection-title' ,
                  innerText: subKey
                }
              ))
              const ulElem = createProjectsList(subSections[subKey], key !== 'Foundation');
              subSectionElem.appendChild(ulElem);
              subSectionContainerElem.appendChild(subSectionElem);
            })
            sectionElem.appendChild(subSectionContainerElem);
          } else {
            const projects = sections[key];
            const ulElem = createProjectsList(projects, true);
            sectionElem.appendChild(ulElem);
          }
          menuContainer.appendChild(sectionElem)
        });
      }

      xhr.onerror = function() {
        console.error("Unable to load projects");
      };

      xhr.send();
    </script>

    
    <script>
      const versioningConfig = {
        githubUser: 'Farama-Foundation',
        githubRepo: 'stable-retro',
      };
      fetch('/main/_static/versioning/versioning_menu.html').then(response => {
        if (response.status === 200) {
            response.text().then(text => {
                const container = document.createElement("div");
                container.innerHTML = text;
                document.querySelector("body").appendChild(container);
                // innerHtml doenst evaluate scripts, we need to add them dynamically
                Array.from(container.querySelectorAll("script")).forEach(oldScript => {
                    const newScript = document.createElement("script");
                    Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                    newScript.appendChild(document.createTextNode(oldScript.innerHTML));
                    oldScript.parentNode.replaceChild(newScript, oldScript);
                });
            });
        } else {
            console.warn("Unable to load versioning menu", response);
        }
      });
    </script>

    </body>
</html>